plugins {
    id 'cpp-library'
    id 'xcode'
    id 'maven-publish'
    id 'cpp-unit-test'
}

group = 'org.gradle.cpp-samples'
version = '1.5'

repositories {
    maven {
        url = 'https://repo.gradle.org/gradle/libs-snapshots-local/'
    }
}

def targetPlatform = compileDebugCpp.targetPlatform

dependencies {
    def osName = targetPlatform.operatingSystem.name.replace(' ', '').toLowerCase()
    if (osName.startsWith('windows')) {
        // Windows 10 binaries are backward compatible with Windows 7
        osName = 'windows10'
    }
    def archName = targetPlatform.architecture.name.replace(' ', '').toLowerCase()
    unitTestImplementation "org.gradle.cpp-samples:googletest_${osName}_${archName}_4.5:latest.integration"
}

tasks.withType(CppCompile) {
    if (toolChain instanceof Gcc) {
        compilerArgs.add('-std=c++11')
    }
}

publishing {
    repositories {
        maven {
            url = '../repo'
        }
    }
}
